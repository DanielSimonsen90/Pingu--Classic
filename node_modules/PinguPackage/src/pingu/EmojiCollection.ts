import { Guild, GuildEmoji, Collection } from "discord.js";
import BasePinguClient from "./client/BasePinguClient";

export class EmojiCollection {
    constructor(client: BasePinguClient<any>) {
        return this.refresh(client);
    }

    private _cached: GuildEmoji[];
    private _client: BasePinguClient<any>

    public get(name: string, limit?: number): GuildEmoji[] {
        return this._cached.filter(e => e.name == name).splice(0, limit);
    }
    public guild(guild: Guild): Collection<string, GuildEmoji> {
        return this._cached.filter(e => e.guild.id == guild.id).reduce((result, e) => result.set(e.name, e), new Collection<string, GuildEmoji>());
    }
    public refresh(client?: BasePinguClient<any>) {
        if (client) this._client = client;

        this._cached = this._client.guilds.cache.reduce((result, guild) => {
            result.push(...guild.emojis.cache.array())
            return result;
        }, new Array<GuildEmoji>());

        this._client.log('console', `Successfully refreshed entries for **Emotes**.`);
        
        return this;
    }
}

export default EmojiCollection;